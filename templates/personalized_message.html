
{% extends "dashboard_base.html" %}

{% block title %}Personalized Message | LeadZap{% endblock %}

{% block content %}
<div class="p-6 min-h-screen bg-[#0D1321]">
    <div class="max-w-4xl mx-auto">
        <!-- Back button -->
        <div class="mb-6">
            <a href="{{ url_for('dashboard') }}" class="flex items-center text-[#7B00FF] hover:text-[#9B30FF]">
                <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"></path>
                </svg>
                Back to Dashboard
            </a>
        </div>
        
        <!-- Lead info card -->
        <div class="mb-8 bg-[#1A2236] rounded-lg p-6 border border-[#7B00FF] shadow-lg">
            <div class="flex justify-between items-start">
                <div>
                    <h1 class="text-2xl font-bold text-white mb-2">{{ lead.name }}</h1>
                    <div class="flex items-center text-[#A1A9B8] mb-1">
                        <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"></path>
                        </svg>
                        {{ lead.email }}
                    </div>
                    <div class="flex items-center text-[#A1A9B8] mb-1">
                        <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"></path>
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"></path>
                        </svg>
                        {{ lead.city if lead.city else "Location Unknown" }}
                    </div>
                    <div class="flex items-center text-[#A1A9B8]">
                        <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                        </svg>
                        {{ lead.niche if lead.niche else lead.source }}
                    </div>
                </div>
                <div class="bg-[#0D1321] px-3 py-1 rounded-full flex items-center">
                    <span class="text-white font-bold mr-1">{{ lead.score }}</span>
                    <span class="text-[#A1A9B8] text-sm">Score</span>
                </div>
            </div>
        </div>
        
        <!-- Personalized message section -->
        <div class="mb-8">
            <h2 class="text-xl font-bold text-white mb-4 flex items-center">
                <svg class="w-5 h-5 mr-2 text-[#7B00FF]" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 10h.01M12 10h.01M16 10h.01M9 16H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-5l-5 5v-5z"></path>
                </svg>
                Personalized Message
            </h2>
            
            <div class="bg-[#1A2236] rounded-lg p-6 border border-[#7B00FF] shadow-lg relative">
                <div class="text-white whitespace-pre-line mb-4">{{ message }}</div>
                
                <div class="flex justify-between mt-4">
                    <button id="copyMessageBtn" class="bg-[#7B00FF] hover:bg-[#9B30FF] text-white px-4 py-2 rounded-md text-sm flex items-center">
                        <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 5H6a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2v-1M8 5a2 2 0 002 2h2a2 2 0 002-2M8 5a2 2 0 012-2h2a2 2 0 012 2m0 0h2a2 2 0 012 2v3m2 4H10m0 0l3-3m-3 3l3 3"></path>
                        </svg>
                        Copy Message
                    </button>
                    <button id="regenerateBtn" class="border border-[#7B00FF] text-[#7B00FF] hover:bg-[#7B00FF] hover:text-white px-4 py-2 rounded-md text-sm flex items-center">
                        <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path>
                        </svg>
                        Regenerate
                    </button>
                </div>
                
                <div id="copySuccess" class="hidden absolute top-2 right-2 bg-green-500 text-white px-3 py-1 rounded-md text-sm">
                    Copied!
                </div>
            </div>
        </div>
        
        <!-- Email Template Section -->
        <div class="mb-8">
            <h2 class="text-xl font-bold text-white mb-4 flex items-center">
                <svg class="w-5 h-5 mr-2 text-[#7B00FF]" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"></path>
                </svg>
                Email Template
            </h2>
            
            <div class="bg-[#1A2236] rounded-lg p-6 border border-[#7B00FF] shadow-lg relative">
                <div class="text-white whitespace-pre-line mb-4 font-mono text-sm">{{ email_template }}</div>
                
                <div class="flex justify-between mt-4">
                    <button id="copyEmailBtn" class="bg-[#7B00FF] hover:bg-[#9B30FF] text-white px-4 py-2 rounded-md text-sm flex items-center">
                        <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 5H6a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2v-1M8 5a2 2 0 002 2h2a2 2 0 002-2M8 5a2 2 0 012-2h2a2 2 0 012 2m0 0h2a2 2 0 012 2v3m2 4H10m0 0l3-3m-3 3l3 3"></path>
                        </svg>
                        Copy Email
                    </button>
                    <a href="mailto:{{ lead.email }}?subject=Helping%20Your%20Business%20Grow&body={{ email_template|urlencode }}" class="border border-[#7B00FF] text-[#7B00FF] hover:bg-[#7B00FF] hover:text-white px-4 py-2 rounded-md text-sm flex items-center">
                        <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"></path>
                        </svg>
                        Open in Mail Client
                    </a>
                </div>
                
                <div id="copyEmailSuccess" class="hidden absolute top-2 right-2 bg-green-500 text-white px-3 py-1 rounded-md text-sm">
                    Copied!
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    // Copy message functionality
    document.getElementById('copyMessageBtn').addEventListener('click', function() {
        const message = document.querySelector('.text-white.whitespace-pre-line').innerText;
        navigator.clipboard.writeText(message).then(function() {
            const copySuccess = document.getElementById('copySuccess');
            copySuccess.classList.remove('hidden');
            setTimeout(function() {
                copySuccess.classList.add('hidden');
            }, 2000);
        });
    });
    
    // Copy email functionality
    document.getElementById('copyEmailBtn').addEventListener('click', function() {
        const emailTemplate = document.querySelector('.font-mono.text-sm').innerText;
        navigator.clipboard.writeText(emailTemplate).then(function() {
            const copyEmailSuccess = document.getElementById('copyEmailSuccess');
            copyEmailSuccess.classList.remove('hidden');
            setTimeout(function() {
                copyEmailSuccess.classList.add('hidden');
            }, 2000);
        });
    });
    
    // Regenerate functionality
    document.getElementById('regenerateBtn').addEventListener('click', function() {
        this.disabled = true;
        this.innerHTML = '<svg class="animate-spin w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path></svg> Generating...';
        
        fetch('/message_api/{{ lead.id }}')
            .then(response => response.json())
            .then(data => {
                if (data.message) {
                    document.querySelector('.text-white.whitespace-pre-line').innerText = data.message;
                }
            })
            .catch(error => {
                console.error('Error:', error);
            })
            .finally(() => {
                const btn = document.getElementById('regenerateBtn');
                btn.disabled = false;
                btn.innerHTML = '<svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path></svg> Regenerate';
            });
    });
</script>
{% endblock %}
