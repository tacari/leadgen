{% extends "dashboard_base.html" %}
{% block title %}Settings{% endblock %}
{% block content %}
<div class="bg-[#0D1321] min-h-screen text-white p-8">
    <h1 class="text-4xl font-bold text-center mb-12">Account Settings</h1>

    <!-- Profile Section -->
    <div class="max-w-2xl mx-auto space-y-8">
        <div class="bg-[#1A2236] border border-[#7B00FF] rounded-lg p-6 animate-fade-in">
            <h2 class="text-2xl font-bold mb-6">Profile</h2>
            <form method="POST" class="space-y-4">
                <div>
                    <label class="block text-white text-base font-bold mb-2">Username</label>
                    <input 
                        type="text" 
                        name="username" 
                        value="{{ username }}"
                        class="w-full bg-[#1A2236] border border-[#7B00FF] rounded-lg p-3 text-white"
                    >
                </div>
                <div>
                    <label class="block text-white text-base font-bold mb-2">Email</label>
                    <input 
                        type="email" 
                        name="email" 
                        value="{{ user_data.email if user_data else '' }}"
                        class="w-full bg-[#1A2236] border border-[#7B00FF] rounded-lg p-3 text-white"
                    >
                </div>
                <button type="submit" class="bg-[#7B00FF] text-white px-5 py-2 rounded-lg hover:bg-[#8F00FF] hover:shadow-lg transform hover:scale-105 transition-transform duration-200">
                    Update Profile
                </button>
            </form>
        </div>

        <!-- Notifications Section -->
        <div class="bg-[#1A2236] border border-[#7B00FF] rounded-lg p-6 animate-fade-in">
            <h2 class="text-2xl font-bold mb-6">Notifications</h2>
            <form method="POST" class="space-y-4">
                <div class="flex items-center justify-between">
                    <label class="text-white">Email me new leads daily</label>
                    <label class="relative inline-flex items-center cursor-pointer">
                        <input type="checkbox" name="new_leads" class="sr-only peer" {{ 'checked' if user.notifications.new_leads }}>
                        <div class="w-11 h-6 bg-[#1A2236] peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-[#7B00FF]"></div>
                    </label>
                </div>
                <div class="flex items-center justify-between">
                    <label class="text-white">Weekly performance summary</label>
                    <label class="relative inline-flex items-center cursor-pointer">
                        <input type="checkbox" name="weekly_summary" class="sr-only peer" {{ 'checked' if user.notifications.weekly_summary }}>
                        <div class="w-11 h-6 bg-[#1A2236] peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-[#7B00FF]"></div>
                    </label>
                </div>
                <div class="flex items-center justify-between">
                    <label class="text-white">Support updates</label>
                    <label class="relative inline-flex items-center cursor-pointer">
                        <input type="checkbox" name="support_updates" class="sr-only peer" {{ 'checked' if user.notifications.support_updates }}>
                        <div class="w-11 h-6 bg-[#1A2236] peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-[#7B00FF]"></div>
                    </label>
                </div>
                <button type="submit" class="bg-[#7B00FF] text-white px-5 py-2 rounded-lg hover:bg-[#8F00FF] hover:shadow-lg transform hover:scale-105 transition-transform duration-200">
                    Save Preferences
                </button>
            </form>
        </div>

        <!-- Billing Section -->
        <div class="bg-[#1A2236] border border-[#7B00FF] rounded-lg p-6 animate-fade-in">
            <h2 class="text-2xl font-bold mb-6">Billing</h2>
            <div class="space-y-4">
                <div>
                    <p class="text-[#A1A9B8] text-lg">Current Plan</p>
                    <p class="text-white text-xl">{{ package.package_name if package else 'No Active Plan' }}</p>
                </div>
                <div>
                    <p class="text-[#A1A9B8] text-lg">Next Billing Date</p>
                    <p class="text-white text-xl">{{ package.next_delivery if package and package.next_delivery else 'N/A' }}</p>
                </div>
                <div class="flex gap-4">
                    <a href="{{ url_for('pricing') }}" class="bg-[#7B00FF] text-white px-5 py-2 rounded-lg hover:bg-[#8F00FF] hover:shadow-lg transform hover:scale-105 transition-transform duration-200">
                        Change Plan
                    </a>
                    <a href="#" class="border border-[#7B00FF] text-white px-5 py-2 rounded-lg hover:bg-[#7B00FF] hover:shadow-lg transform hover:scale-105 transition-transform duration-200">
                        Manage Billing
                    </a>
                </div>
            </div>
        </div>

        <!-- API Integration Section -->
        <div class="mb-8">
            <h2 class="text-3xl font-bold text-center mb-8">API Integration</h2>
            <div class="bg-[#1A2236] border border-[#7B00FF] rounded-lg p-6 max-w-2xl mx-auto">
                <p class="text-[#A1A9B8] mb-4">Your API Key:</p>
                <div class="flex items-center">
                    <input type="text" value="{{ api_key }}" id="apiKey" readonly class="w-full bg-[#0D1321] border border-[#7B00FF] rounded-lg p-3 text-[#A1A9B8]">
                    <button onclick="copyApiKey()" class="ml-2 bg-[#7B00FF] text-white p-3 rounded-lg hover:bg-[#8F00FF]">
                        Copy
                    </button>
                </div>
                <p class="text-[#A1A9B8] mt-4 text-sm">Use this API key to access the Leadzap API for custom integrations.</p>
            </div>
        </div>

        <!-- CRM Workflow Automation Settings -->
        <div class="mb-8">
            <h2 class="text-3xl font-bold text-center mb-8">CRM Workflow Automation</h2>
            <div class="bg-[#1A2236] border border-[#7B00FF] rounded-lg p-6 max-w-2xl mx-auto">
                <form method="POST" action="{{ url_for('update_crm_settings') }}">
                    <div class="mb-4">
                        <label class="block text-white text-base font-bold mb-2">HubSpot API Key</label>
                        <input name="hubspot_api_key" type="text" value="{{ hubspot_api_key or '' }}" class="w-full bg-[#0D1321] border border-[#7B00FF] rounded-lg p-3 text-white placeholder-[#A1A9B8]" placeholder="Enter your HubSpot API key">
                        <p class="text-[#A1A9B8] mt-1 text-sm">Get this from your HubSpot Developer Account</p>
                    </div>
                    <div class="mb-4">
                        <label class="block text-white text-base font-bold mb-2">Slack Webhook URL</label>
                        <input name="slack_webhook_url" type="text" value="{{ slack_webhook_url or '' }}" class="w-full bg-[#0D1321] border border-[#7B00FF] rounded-lg p-3 text-white placeholder-[#A1A9B8]" placeholder="Enter your Slack webhook URL">
                        <p class="text-[#A1A9B8] mt-1 text-sm">Create this in your Slack App Settings</p>
                    </div>
                    <div class="flex justify-between items-center">
                        <div class="text-[#A1A9B8]">
                            <span class="font-bold">Status:</span> 
                            {% if hubspot_api_key %}
                            <span class="text-green-400">Active ✓</span>
                            {% else %}
                            <span class="text-yellow-400">Inactive ⚠</span>
                            {% endif %}
                        </div>
                        <button type="submit" class="bg-[#7B00FF] text-white px-6 py-3 rounded-lg text-lg font-bold hover:bg-[#8F00FF] hover:shadow-lg">Save Settings</button>
                    </div>
                </form>
            </div>
            <div class="max-w-2xl mx-auto mt-4 p-4 bg-[#1A2236] border border-[#7B00FF] rounded-lg">
                <h3 class="text-xl font-bold mb-2 text-white">How it works:</h3>
                <ul class="list-disc pl-5 text-[#A1A9B8] space-y-2">
                    <li>Your leads are automatically added to your HubSpot CRM</li>
                    <li>High-scoring leads (>75) are tagged as "Hot Leads" for priority follow-up</li>
                    <li>Your team receives instant Slack notifications for new leads</li>
                    <li>Lead statuses update automatically based on interactions</li>
                </ul>
            </div>
        </div>
    </div>
</div>

<style>
    @keyframes fade-in {
        from { opacity: 0; transform: translateY(20px); }
        to { opacity: 1; transform: translateY(0); }
    }
    .animate-fade-in {
        animation: fade-in 0.5s ease-out;
        animation-fill-mode: both;
    }
</style>

<script>
    function copyApiKey() {
        var apiKeyField = document.getElementById("apiKey");
        apiKeyField.select();
        document.execCommand("copy");
        alert("API key copied to clipboard!");
    }
</script>
{% endblock %}