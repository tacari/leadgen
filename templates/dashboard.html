{% extends "base.html" %}
{% block title %}Dashboard - Leadzap{% endblock %}
{% block content %}
<div class="bg-[#0D1321] min-h-screen text-white p-8">
    <!-- Header -->
    <header class="text-center py-10 relative animate-fade-in">
        <h1 class="text-4xl font-bold">Hey {{ username }}, Welcome to Your Leadzap Dashboard</h1>
    </header>

    <!-- Leads -->
    <section class="mb-12">
        <h2 class="text-3xl font-bold text-center mb-6">Your Lead Pipeline</h2>
        <div class="bg-[#1A2236] border border-[#7B00FF] rounded-lg p-6 max-w-6xl mx-auto">
            <div class="flex flex-wrap gap-4 mb-4">
                <button class="filter-btn bg-[#0D1321] border border-[#7B00FF] px-4 py-2 rounded-lg text-sm hover:bg-[#7B00FF] hover:text-white active" onclick="filterLeads('all')">All</button>
                <button class="filter-btn bg-[#0D1321] border border-[#7B00FF] px-4 py-2 rounded-lg text-sm hover:bg-[#7B00FF] hover:text-white" onclick="filterLeads('verified')">Verified Only</button>
                <button class="filter-btn bg-[#0D1321] border border-[#7B00FF] px-4 py-2 rounded-lg text-sm hover:bg-[#7B00FF] hover:text-white" onclick="filterLeads('highScore')">High Score (>75)</button>
                <button class="filter-btn bg-[#0D1321] border border-[#7B00FF] px-4 py-2 rounded-lg text-sm hover:bg-[#7B00FF] hover:text-white" onclick="filterLeads('recent')">Last 7 Days</button>
            </div>
            <!-- Desktop Table / Mobile Cards -->
            <div class="hidden md:block overflow-x-auto">
                <table class="w-full text-left text-[#A1A9B8] text-sm">
                    <thead>
                        <tr class="border-b border-[#7B00FF]">
                            <th class="p-3">Name</th>
                            <th class="p-3">Email</th>
                            <th class="p-3">Source</th>
                            <th class="p-3">Score</th>
                            <th class="p-3">Status</th>
                            <th class="p-3">Date Added</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for lead in leads %}
                        <tr class="border-b border-[#7B00FF] animate-fade-in" data-score="{{ lead.score }}" data-date="{{ lead.date_added }}" style="animation-delay: {{ loop.index0 * 0.1 }}s">
                            <td class="p-3">{{ lead.name }}</td>
                            <td class="p-3">{{ lead.email }}</td>
                            <td class="p-3">{{ lead.source }}</td>
                            <td class="p-3 {% if lead.score > 75 %}text-[#7B00FF]{% endif %}">{{ lead.score }}</td>
                            <td class="p-3">{{ lead.status }}</td>
                            <td class="p-3">{{ lead.date_added }}</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
            <!-- Mobile Cards -->
            <div class="md:hidden space-y-4">
                {% for lead in leads %}
                <div class="bg-[#0D1321] border border-[#7B00FF] rounded-lg p-4 animate-fade-in" data-score="{{ lead.score }}" data-date="{{ lead.date_added }}" style="animation-delay: {{ loop.index0 * 0.1 }}s">
                    <div class="flex justify-between items-start mb-2">
                        <h3 class="font-bold">{{ lead.name }}</h3>
                        <span class="{% if lead.score > 75 %}text-[#7B00FF]{% endif %}">Score: {{ lead.score }}</span>
                    </div>
                    <p class="text-[#A1A9B8] text-sm mb-1">{{ lead.email }}</p>
                    <p class="text-[#A1A9B8] text-sm mb-1">Source: {{ lead.source }}</p>
                    <div class="flex justify-between text-sm">
                        <span>Status: {{ lead.status }}</span>
                        <span>{{ lead.date_added }}</span>
                    </div>
                </div>
                {% endfor %}
            </div>
            <div class="mt-4 flex gap-4 justify-center">
                <a href="{{ url_for('download_leads') }}" class="bg-[#7B00FF] text-white px-5 py-2 rounded-lg hover:bg-[#8F00FF] hover:shadow-lg transform hover:scale-105 transition-transform duration-200">Download Leads (CSV)</a>
            </div>
        </div>
    </section>

    <!-- Subscription -->
    <section class="mb-12">
        <h2 class="text-3xl font-bold text-center mb-6">Your Leadzap Plan</h2>
        <div class="bg-[#1A2236] border border-[#7B00FF] rounded-lg p-6 max-w-[400px] mx-auto animate-fade-in">
            <p class="text-xl font-bold text-center">{{ subscription.package_name if subscription else 'No Active Plan' }}</p>
            <p class="text-[#A1A9B8] text-center mb-2">{{ subscription.lead_volume if subscription else '0' }} leads/month</p>
            <p class="text-[#A1A9B8] text-center mb-2">${{ "{:,.0f}".format(subscription.lead_volume * 10 if subscription else 0) }}/month</p>
            <p class="text-[#7B00FF] font-bold text-center mb-4">Active</p>
            <div class="flex gap-4 justify-center">
                <a href="{{ url_for('pricing') }}" class="bg-[#7B00FF] text-white px-4 py-2 rounded-lg hover:bg-[#8F00FF] hover:shadow-lg transform hover:scale-105 transition-transform duration-200">Upgrade Plan</a>
                <a href="#" class="border border-[#7B00FF] text-white px-4 py-2 rounded-lg hover:bg-[#7B00FF] hover:shadow-lg transform hover:scale-105 transition-transform duration-200">Manage Subscription</a>
            </div>
        </div>
    </section>

    <!-- Analytics -->
    <section class="mb-12">
        <h2 class="text-3xl font-bold text-center mb-6">Lead Analytics</h2>
        <div class="bg-[#1A2236] border border-[#7B00FF] rounded-lg p-6 max-w-[600px] mx-auto animate-fade-in">
            <div class="grid grid-cols-2 gap-4 mb-6">
                <div class="text-center animate-fade-in" style="animation-delay: 0.1s">
                    <p class="text-2xl font-bold text-white">{{ analytics.total }}</p>
                    <p class="text-[#A1A9B8] text-base">Total Leads</p>
                </div>
                <div class="text-center animate-fade-in" style="animation-delay: 0.2s">
                    <p class="text-2xl font-bold text-[#A1A9B8]">{{ analytics.emailed }}</p>
                    <p class="text-[#A1A9B8] text-base">Emailed</p>
                </div>
                <div class="text-center animate-fade-in" style="animation-delay: 0.3s">
                    <p class="text-2xl font-bold text-[#A1A9B8]">{{ analytics.replies }}</p>
                    <p class="text-[#A1A9B8] text-base">Replies</p>
                </div>
                <div class="text-center animate-fade-in" style="animation-delay: 0.4s">
                    <p class="text-2xl font-bold text-[#A1A9B8]">{{ analytics.conversions }}</p>
                    <p class="text-[#A1A9B8] text-base">Conversions</p>
                </div>
            </div>
            <div style="height: 200px; width: 400px; margin: 0 auto;">
                <canvas id="analyticsChart"></canvas>
            </div>
        </div>
    </section>

    <!-- Delivery Status -->
    <section class="mb-12">
        <h2 class="text-3xl font-bold text-center mb-6">Next Lead Drop</h2>
        <div class="bg-[#1A2236] border border-[#7B00FF] rounded-lg p-6 max-w-[400px] mx-auto animate-fade-in">
            {% if subscription %}
                {% if subscription.package_name == 'Lead Launch' %}
                    <p class="text-[#A1A9B8] text-base text-center">Your 50 leads arrive by {{ (now + timedelta(days=7)).strftime('%B %d, %Y') }}</p>
                {% elif subscription.package_name == 'Lead Engine' %}
                    <p class="text-[#A1A9B8] text-base text-center">Next 37-38 leads: Weekly delivery</p>
                {% elif subscription.package_name == 'Lead Accelerator' %}
                    <p class="text-[#A1A9B8] text-base text-center">Next 12-13 leads: Tomorrow</p>
                {% elif subscription.package_name == 'Empire' %}
                    <p class="text-[#A1A9B8] text-base text-center">Next 25 leads: Tomorrow</p>
                {% else %}
                    <p class="text-[#A1A9B8] text-base text-center">{{ delivery_status }}</p>
                {% endif %}
            {% else %}
                <p class="text-[#A1A9B8] text-base text-center">No active subscription</p>
            {% endif %}
        </div>
    </section>
</div>

<!-- Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
    const ctx = document.getElementById('analyticsChart').getContext('2d');
    new Chart(ctx, {
        type: 'bar',
        data: {
            labels: ['Total', 'Emailed', 'Replies', 'Conversions'],
            datasets: [{
                label: 'Lead Stats',
                data: [{{ analytics.total }}, {{ analytics.emailed }}, {{ analytics.replies }}, {{ analytics.conversions }}],
                backgroundColor: '#7B00FF',
                borderColor: '#8F00FF',
                borderWidth: 1
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: {
                    display: false
                }
            },
            scales: {
                y: {
                    beginAtZero: true,
                    grid: {
                        color: '#1A2236'
                    },
                    ticks: {
                        color: '#A1A9B8'
                    }
                },
                x: {
                    grid: {
                        color: '#1A2236'
                    },
                    ticks: {
                        color: '#A1A9B8'
                    }
                }
            }
        }
    });
</script>

<style>
    @keyframes fade-in {
        from { opacity: 0; transform: translateY(20px); }
        to { opacity: 1; transform: translateY(0); }
    }
    .animate-fade-in {
        animation: fade-in 0.5s ease-out;
        animation-fill-mode: both;
    }
</style>
{% endblock %}